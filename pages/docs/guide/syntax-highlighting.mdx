import { OptionTable } from "components/table";
import { Callout } from "nextra/components";

# è¯­æ³•é«˜äº®

Nextra ä½¿ç”¨ [Shiki](https://shiki.matsu.io) åœ¨æ„å»ºæ—¶è¿›è¡Œè¯­æ³•é«˜äº®ã€‚å®ƒéå¸¸å¯é ä¸”æ€§èƒ½ä¼˜è¶Šã€‚ä¾‹å¦‚ï¼Œåœ¨æ‚¨çš„ Markdown æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

````md filename="Markdown"
```js
console.log("hello, world");
```
````

ç»“æœæ˜¯ï¼š

```js
console.log("hello, world");
```

## ç‰¹æ€§

### å†…è”ä»£ç 

å†…è”è¯­æ³•é«˜äº®ï¼ˆä¾‹å¦‚ `let x = 1{:jsx}`ï¼‰ä¹Ÿé€šè¿‡ `{:}` è¯­æ³•æ”¯æŒï¼š

```md filename="Markdown"
å†…è”è¯­æ³•é«˜äº®ä¹Ÿæ”¯æŒ `let x = 1{:jsx}` è¯­æ³•ï¼š
```

### é«˜äº®è¡Œ

æ‚¨å¯ä»¥é€šè¿‡å‘ä»£ç å—æ·»åŠ  `{}` å±æ€§æ¥é«˜äº®ç‰¹å®šçš„ä»£ç è¡Œï¼š

````md filename="Markdown"
```js {1,4-5}
import { useState } from "react";

function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}
```
````

ç»“æœï¼š

```js {1,4-5}
import { useState } from "react";

function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}
```

### é«˜äº®å­å­—ç¬¦ä¸²

æ‚¨å¯ä»¥é€šè¿‡å‘ä»£ç å—æ·»åŠ  `//` å±æ€§æ¥é«˜äº®ç‰¹å®šçš„ä»£ç å­å­—ç¬¦ä¸²ï¼š

````md filename="Markdown"
```js /useState/
import { useState } from "react";

function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}
```
````

```js /useState/
import { useState } from "react";

function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}
```

æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªæ•°å­—æ¥ä»…é«˜äº®è¯¥å­å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼š`/str/1`ï¼Œæˆ–å¤šä¸ªï¼š`/str/1-3`ï¼Œ`/str/1,3`ã€‚

### å¤åˆ¶æŒ‰é’®

é€šè¿‡æ·»åŠ  `copy` å±æ€§ï¼Œå½“ç”¨æˆ·æ‚¬åœåœ¨ä»£ç å—ä¸Šæ—¶ï¼Œä¼šæ·»åŠ ä¸€ä¸ªå¤åˆ¶æŒ‰é’®ï¼š

````md filename="Markdown"
```js copy
console.log("hello, world");
```
````

æ¸²æŸ“ï¼š

```js copy
console.log("hello, world");
```

æ‚¨å¯ä»¥é€šè¿‡åœ¨ Nextra é…ç½®ï¼ˆ`next.config.js` æ–‡ä»¶ï¼‰ä¸­è®¾ç½® `defaultShowCopyCode: true` æ¥å…¨å±€å¯ç”¨æ­¤åŠŸèƒ½ã€‚ä¸€æ—¦å…¨å±€å¯ç”¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡ `copy=false` å±æ€§ç¦ç”¨å®ƒã€‚

### è¡Œå·

æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ  `showLineNumbers` å±æ€§æ¥ä¸ºä»£ç å—æ·»åŠ è¡Œå·ï¼š

````md filename="Markdown"
```js showLineNumbers
import { useState } from "react";

function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}
```
````

æ¸²æŸ“ï¼š

```js showLineNumbers
import { useState } from "react";

function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}
```

### æ–‡ä»¶åå’Œæ ‡é¢˜

æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ  `filename` å±æ€§ä¸ºä»£ç å—æ·»åŠ æ–‡ä»¶åæˆ–æ ‡é¢˜ï¼š

````md filename="Markdown"
```js filename="example.js"
console.log("hello, world");
```
````

æ¸²æŸ“ï¼š

```js filename="example.js"
console.log("hello, world");
```

### ANSI é«˜äº®

æ‚¨å¯ä»¥é«˜äº® ANSI è½¬ä¹‰ç ï¼š

````md filename="Markdown"
```ansi
[0m [0;32mâœ“[0m [0;2msrc/[0mindex[0;2m.test.ts (1)[0m
  [0;2m Test Files [0m [0;1;32m1 passed[0;98m (1)[0m
  [0;2m      Tests [0m [0;1;32m1 passed[0;98m (1)[0m
  [0;2m   Start at [0m 23:32:41
  [0;2m   Duration [0m 11ms
  [42;1;39;0m PASS [0;32m Waiting for file changes...[0m
         [0;2mpress [0;1mh[0;2m to show help, press [0;1mq[0;2m to quit
```
````

æ¸²æŸ“ï¼š

```ansi
[0m [0;32mâœ“[0m [0;2msrc/[0mindex[0;2m.test.ts (1)[0m
  [0;2m Test Files [0m [0;1;32m1 passed[0;98m (1)[0m
  [0;2m      Tests [0m [0;1;32m1 passed[0;98m (1)[0m
  [0;2m   Start at [0m 23:32:41
  [0;2m   Duration [0m 11ms
  [42;1;39;0m PASS [0;32m Waiting for file changes...[0m
         [0;2mpress [0;1mh[0;2m to show help, press [0;1mq[0;2m to quit
```

## æ”¯æŒçš„è¯­è¨€

æŸ¥çœ‹[æ­¤åˆ—è¡¨](https://github.com/shikijs/shiki/blob/main/docs/languages.md)äº†è§£æ‰€æœ‰æ”¯æŒçš„è¯­è¨€ã€‚

## è‡ªå®šä¹‰ä¸»é¢˜

Nextra ä½¿ç”¨ CSS å˜é‡æ¥å®šä¹‰ä»¤ç‰Œçš„é¢œè‰²ã€‚æ‚¨å¯ä»¥æ³¨å…¥ä¸€ä¸ª[å…¨å±€ CSS](https://nextjs.org/docs/basic-features/built-in-css-support#adding-a-global-stylesheet) æ¥åœ¨æµ…è‰²/æ·±è‰²ä¸»é¢˜ä¸‹è‡ªå®šä¹‰å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯é»˜è®¤çš„ä»¤ç‰Œï¼Œæ‚¨å¯ä»¥è¦†ç›–å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼š

```css filename="styles.css"
:root {
  --shiki-color-text: #414141;
  --shiki-color-background: transparent;
  --shiki-token-constant: #1976d2;
  --shiki-token-string: #22863a;
  --shiki-token-comment: #aaa;
  --shiki-token-keyword: #d32f2f;
  --shiki-token-parameter: #ff9800;
  --shiki-token-function: #6f42c1;
  --shiki-token-string-expression: #22863a;
  --shiki-token-punctuation: #212121;
  --shiki-token-link: #22863a;
}

.dark {
  --shiki-color-text: #d1d1d1;
  --shiki-token-constant: #79b8ff;
  --shiki-token-string: #ffab70;
  --shiki-token-comment: #6b737c;
  --shiki-token-keyword: #f97583;
  --shiki-token-parameter: #ff9800;
  --shiki-token-function: #b392f0;
  --shiki-token-string-expression: #4bb74a;
  --shiki-token-punctuation: #bbb;
  --shiki-token-link: #ffab70;
}
```

## ä½¿ç”¨åŠ¨æ€å†…å®¹

ç”±äºè¯­æ³•é«˜äº®æ˜¯åœ¨æ„å»ºæ—¶å®Œæˆçš„ï¼Œå› æ­¤æ‚¨æ— æ³•åœ¨ä»£ç å—ä¸­ä½¿ç”¨åŠ¨æ€å†…å®¹ã€‚ç„¶è€Œï¼Œç”±äº MDX éå¸¸å¼ºå¤§ï¼Œå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯ JS è¿›è¡Œå˜é€šã€‚ä¾‹å¦‚ï¼š

import { useEffect, useRef } from "react";

export function DynamicCode({ children }) {
  const ref = useRef();
  const tokenRef = useRef();
  // ä» DOM ä¸­æ‰¾åˆ°å¯¹åº”çš„ä»¤ç‰Œ
  useEffect(() => {
    if (ref.current) {
      const token = [...ref.current.querySelectorAll("code span")].find(
        (el) => el.innerText === "1"
      );
      tokenRef.current = token;
    }
  }, []);
  return (
    <>
      <div ref={ref} style={{ marginTop: "1.5rem" }}>
        {children}
      </div>
      <a
        onClick={() => {
          tokenRef.current.innerText =
            (parseInt(tokenRef.current.innerText) || 0) + 1;
        }}
        style={{
          cursor: "pointer",
          userSelect: "none",
        }}
      >
        å¢åŠ æ•°å­—
      </a>
      <a
        onClick={() => {
          tokenRef.current.innerText = "1 + 1";
        }}
        style={{
          marginLeft: ".5rem",
          cursor: "pointer",
          userSelect: "none",
        }}
      >
        æ›´æ”¹ä¸º `1 + 1`
      </a>
    </>
  );
}

<DynamicCode>
```js filename="dynamic_code.js"
function hello () {
  const x = 2 + 3
  console.log(1)
}
```
</DynamicCode>

è¿™ç§å˜é€šæœ‰ä¸€ä¸ªé™åˆ¶ï¼Œå³æ›´æ–°çš„å†…å®¹ä¸ä¼šé‡æ–°é«˜äº®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å°†æ•°å­—æ›´æ–°ä¸º `1 + 1`ï¼Œå®ƒå°†è¢«é”™è¯¯åœ°é«˜äº®ã€‚

æŸ¥çœ‹[ä»£ç ](https://github.com/shuding/nextra/blob/main/docs/pages/docs/guide/syntax-highlighting.mdx)ä»¥äº†è§£å…¶å·¥ä½œåŸç†ã€‚

## ç¦ç”¨è¯­æ³•é«˜äº®

æ‚¨å¯ä»¥é€‰æ‹©ä¸ä½¿ç”¨è¯­æ³•é«˜äº®ï¼Œä»¥ä¾¿ä½¿ç”¨æ‚¨è‡ªå·±çš„é«˜äº®æ–¹å¼ã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨ Nextra é…ç½®ï¼ˆ`next.config.js` æ–‡ä»¶ï¼‰ä¸­è®¾ç½® `codeHighlight: false` æ¥å…¨å±€ç¦ç”¨è¯­æ³•é«˜äº®ã€‚

<OptionTable
  options={[["codeHighlight", "boolean", "å¯ç”¨æˆ–ç¦ç”¨è¯­æ³•é«˜äº®ã€‚é»˜è®¤ä¸º `true`."]]}
/>

## è‡ªå®šä¹‰è¯­æ³•

Shiki æ¥å—ä¸€ä¸ª [VSCode TextMate è¯­æ³•](https://code.visualstudio.com/api/language-extensions/syntax-highlight-guide) ä»¥ä½¿ç”¨è‡ªå®šä¹‰è¯­è¨€è¯­æ³•è¿›è¡Œè¯­æ³•é«˜äº®ã€‚

æ‚¨å¯ä»¥é€šè¿‡åœ¨ Nextra é…ç½®ä¸­çš„ `mdxOptions.rehypePrettyCodeOptions` é€‰é¡¹ä¸­è¦†ç›– `getHighlighter` å‡½æ•°æ¥æä¾›è¿™äº›è¯­æ³•ï¼Œåœ¨ `next.config.js` æ–‡ä»¶ä¸­ï¼š

```js filename="next.config.js" {13-18}
import { BUNDLED_LANGUAGES } from "shiki";

nextra({
  // ... å…¶ä»–é€‰é¡¹
  mdxOptions: {
    rehypePrettyCodeOptions: {
      getHighlighter: (options) =>
        getHighlighter({
          ...options,
          langs: [
            ...BUNDLED_LANGUAGES,
            // è‡ªå®šä¹‰è¯­æ³•é€‰é¡¹ï¼Œå‚è§ Shiki æ–‡æ¡£äº†è§£å¦‚ä½•æä¾›è¿™äº›é€‰é¡¹
            {
              id: "my-lang",
              scopeName: "source.my-lang",
              aliases: ["mylang"], // é™¤äº† idï¼Œåˆ«åä¹Ÿä¼šåŒ…å«åœ¨æ‚¨ç¼–å†™ markdown æ—¶å¯ä»¥ä½¿ç”¨çš„å…è®¸åç§°ä¸­ã€‚
              path: "../../public/syntax/grammar.tmLanguage.json",
            },
          ],
        }),
    },
  },
});
```

## è‡ªå®šä¹‰ä¸»é¢˜

åœ¨ `mdxOptions.rehypePrettyCodeOptions` ä¸­ï¼Œæ‚¨è¿˜å¯ä»¥æä¾›è‡ªå®šä¹‰ä¸»é¢˜ï¼Œè€Œä¸æ˜¯[ä¾èµ– CSS å˜é‡](/docs/guide/syntax-highlighting)ï¼š

```js filename="next.config.js" {4}
nextra({
  // ... å…¶ä»–é€‰é¡¹
  mdxOptions: {
    rehypePrettyCodeOptions: {
      // VSCode ä¸»é¢˜æˆ–å†…ç½® Shiki ä¸»é¢˜ï¼Œå‚è§ Shiki æ–‡æ¡£äº†è§£æ›´å¤šä¿¡æ¯
      theme: JSON.parse(
        readFileSync("./public/syntax/arctis_light.json", "utf8")
      ),
    },
  },
});
```

### å¤šä¸ªä¸»é¢˜

Nextra å½“å‰ä¸æ”¯æŒæŒ‡å®šå¤šä¸ªä¸»é¢˜ã€‚å› ä¸º Shiki ä¸ºæ¯ä¸ªä¸»é¢˜æ¸²æŸ“å¤šä¸ªä»£ç å—ï¼Œå¹¶ç”¨ä¸€ä¸ª `data-theme` å±æ€§æ ‡è®°å®ƒä»¬ï¼Œä¾‹å¦‚ `data-theme="dark"`ã€‚

<Callout type="info">
  ç„¶è€Œï¼Œå°†æ¥ä¼šæ”¯æŒå¤šä¸ªä¸»é¢˜ã€‚æ‚¨å¯ä»¥åœ¨ shikijiï¼ˆShiki çš„æ–°åˆ†æ”¯ï¼‰ä¸­è·Ÿè¸ªè¿›åº¦
  https://github.com/antfu/shikiji#multiple-themesï¼Œè¯¥åˆ†æ”¯å·²ç»æ”¯æŒå¤šä¸ªä¸»é¢˜è€Œæ— éœ€æ¸²æŸ“å¤šä¸ªä»£ç å—.
</Callout>
